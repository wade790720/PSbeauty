"use strict";(self.webpackChunkpsbeauty=self.webpackChunkpsbeauty||[]).push([[760],{4719:function(n,e,t){t.d(e,{Z:function(){return s}});var r=t(1413),i=t(4925),o="Backdrop_wrapper__LB3Yk",a=t(1694),c=t.n(a),l=t(184),u=["style"],s=function(n){var e=n.style,t=void 0===e?{}:e,a=(0,i.Z)(n,u);return(0,l.jsx)("div",{className:c()(o,a.className),style:(0,r.Z)({},t),children:a.children})}},6427:function(n,e,t){t.d(e,{Z:function(){return g}});var r=t(1413),i=t(4942),o=t(4925),a="Header_wrapper__e2tXX",c="Header_large__tDbDa",l="Header_small__U9DHq",u="Header_back__Chgho",s="Header_title__87Ruw",d="Header_has-back__h6eqr",v=t(1694),f=t.n(v),p=t(9411),m=t(6871),h=t(184),_=["style"],g=function(n){var e,t=n.style,v=void 0===t?{}:t,g=(0,o.Z)(n,_),y=(0,m.s0)(),C=(0,m.UO)().text;return(0,h.jsxs)("div",{className:f()(a,g.className,(e={},(0,i.Z)(e,c,g.title||g.children),(0,i.Z)(e,l,!g.title&&!g.leftArrow),e)),style:(0,r.Z)({},v),children:[g.leftArrow&&(0,h.jsx)("div",{onClick:function(){return g.redirect?g.redirect():y(C?-2:-1)},children:(0,h.jsx)(p.Z,{className:u,name:"LeftArrow"})}),g.title?(0,h.jsx)("div",{className:f()(s,(0,i.Z)({},d,g.leftArrow)),children:g.title}):g.children]})}},1220:function(n,e,t){t.d(e,{Z:function(){return g}});var r=t(885),i=t(2791),o="HistoryRecordCard_wrapper__YdfQX",a="HistoryRecordCard_title__kZ9xc",c="HistoryRecordCard_date__a43-L",l="HistoryRecordCard_images__07MUh",u="HistoryRecordCard_content__vGvkA",s="HistoryRecordCard_open__kAqbY",d="HistoryRecordCard_more__PtkOB",v="HistoryRecordCard_tags__ZwCeD",f="HistoryRecordCard_toggle__7H1vm",p=t(1694),m=t.n(p),h=t(862),_=t(184),g=function(n){var e,t=Object.assign({},n),p=(0,i.useState)(!1),g=(0,r.Z)(p,2),y=g[0],C=g[1],x=(0,i.useState)(!1),j=(0,r.Z)(x,2),Z=j[0],w=j[1],b=(0,i.useState)(),I=(0,r.Z)(b,2),k=I[0],N=I[1],R=(0,i.useRef)(null);return(0,i.useEffect)((function(){N(t.toggle)}),[t.toggle]),(0,i.useLayoutEffect)((function(){var n,e,t=(null===(n=R.current)||void 0===n?void 0:n.clientHeight)||0,r=(null===(e=R.current)||void 0===e?void 0:e.scrollHeight)||0;t&&r>t&&C(!0)}),[]),(0,_.jsxs)("div",{className:o,children:[(0,_.jsx)("div",{className:a,children:t.title}),(0,_.jsx)("div",{className:c,children:t.date}),t.images.length>0&&(0,_.jsx)("div",{className:l,children:t.images.map((function(n,e){return(0,_.jsx)("img",{src:n},"img-".concat(e))}))}),(0,_.jsx)("div",{className:m()(u,Z&&s),ref:R,children:t.introduction}),y&&!Z&&(0,_.jsx)("span",{className:d,onClick:function(){return w(!0)},children:"\u986f\u793a\u66f4\u591a"}),(0,_.jsx)("div",{className:v,children:null===(e=t.tags)||void 0===e?void 0:e.map((function(n,e){return(0,_.jsxs)("div",{children:[(0,_.jsx)("span",{children:"#"}),n]},"tag-".concat(e))}))}),"boolean"===typeof t.toggle&&(0,_.jsx)("div",{className:f,children:(0,_.jsx)(h.default,{checkedIcon:!1,uncheckedIcon:!1,width:51,height:31,onColor:"#7873E5",offColor:"#CBCBCD",activeBoxShadow:"0 0 2px 3px #7873E533",checked:k||!1,onChange:function(){t.onChange&&(N(!k),t.onChange({id:t.id,enable:!t.toggle}))}})})]})}},4531:function(n,e,t){t.r(e),t.d(e,{default:function(){return tn}});var r,i,o,a=t(4165),c=t(5861),l=t(2982),u=t(885),s=t(1694),d=t.n(s),v=t(1220),f=t(4719),p=t(6427),m=t(7892),h=t.n(m),_=t(8820),g=t(2791),y=t(6871),C=t(1413),x=t(168),j=t(7743),Z=t(6578),w=t(4376),b={},I=(0,j.Ps)(r||(r=(0,x.Z)(["\n  query GeTopicDetail($input: String) {\n    topic(topicId: $input) {\n      clinic {\n        id\n        name\n        paid\n        owners {\n          id\n        }\n      }\n      consult {\n        id\n        consultAt\n        days\n        subject\n        images\n        consultAt\n        content\n        oneOnOne\n        poster {\n          id\n        }\n        categories {\n          id\n          name\n        }\n      }\n      replies {\n        id\n        content\n        contentType\n        readAt\n        userId\n      }\n    }\n  }\n"])));var k=(0,j.Ps)(i||(i=(0,x.Z)(["\n  mutation replyTopic($input: ReplyTopicInput) {\n    replyTopic(input: $input) {\n      id\n    }\n  }\n"])));var N=(0,j.Ps)(o||(o=(0,x.Z)(["\n  mutation readReply($input: ReadReplyInput) {\n    readReply(input: $input) {\n      replyId\n    }\n  }\n"])));var R,H,O="Chatroom_wrapper__WRyWi",T="Chatroom_row__lnyku",A="Chatroom_left__bYw84",E="Chatroom_avatar__A97b5",B="Chatroom_user-avatar__m3BYD",D="Chatroom_message__ADK3W",M="Chatroom_right__h-RGC",S="Chatroom_center__EBdCa",Y="Chatroom_image__tO+75",L="Chatroom_input__V9jzc",U="Chatroom_control__f1Yvc",P="Chatroom_submit__1ExW0",V=["title","titleId"];function $(){return $=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},$.apply(this,arguments)}function q(n,e){if(null==n)return{};var t,r,i=function(n,e){if(null==n)return{};var t,r,i={},o=Object.keys(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||(i[t]=n[t]);return i}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function W(n,e){var t=n.title,r=n.titleId,i=q(n,V);return g.createElement("svg",$({width:16,height:14,viewBox:"0 0 16 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,"aria-labelledby":r},i),t?g.createElement("title",{id:r},t):null,R||(R=g.createElement("path",{d:"M6.00195 4.5C6.00195 4.89782 5.84392 5.27936 5.56261 5.56066C5.28131 5.84196 4.89978 6 4.50195 6C4.10413 6 3.7226 5.84196 3.44129 5.56066C3.15999 5.27936 3.00195 4.89782 3.00195 4.5C3.00195 4.10218 3.15999 3.72064 3.44129 3.43934C3.7226 3.15804 4.10413 3 4.50195 3C4.89978 3 5.28131 3.15804 5.56261 3.43934C5.84392 3.72064 6.00195 4.10218 6.00195 4.5Z",fill:"#AAB0B2"})),H||(H=g.createElement("path",{d:"M2.00195 0C1.47152 0 0.962812 0.210714 0.58774 0.585786C0.212667 0.960859 0.00195313 1.46957 0.00195312 2V12C0.00195313 12.5304 0.212667 13.0391 0.58774 13.4142C0.962812 13.7893 1.47152 14 2.00195 14H14.002C14.5324 14 15.0411 13.7893 15.4162 13.4142C15.7912 13.0391 16.002 12.5304 16.002 12V2C16.002 1.46957 15.7912 0.960859 15.4162 0.585786C15.0411 0.210714 14.5324 0 14.002 0H2.00195ZM14.002 1C14.2672 1 14.5215 1.10536 14.7091 1.29289C14.8966 1.48043 15.002 1.73478 15.002 2V8.5L11.225 6.553C11.1312 6.50602 11.025 6.48973 10.9215 6.50642C10.8179 6.52311 10.7222 6.57194 10.648 6.646L6.93795 10.356L4.27795 8.584C4.18191 8.52006 4.06672 8.4913 3.95189 8.5026C3.83707 8.5139 3.72969 8.56456 3.64795 8.646L1.00195 11V2C1.00195 1.73478 1.10731 1.48043 1.29485 1.29289C1.48238 1.10536 1.73674 1 2.00195 1H14.002Z",fill:"#AAB0B2"})))}var F=g.forwardRef(W),G=(t.p,t(9062)),J=t(2284),K=function(n){var e=n.chatroomId,t=n.onMessage;if(!e)throw new Error("\u5fc5\u9700\u8981\u63d0\u4f9b chatroomId\u3002");var r=(0,g.useRef)(!1),i=(0,g.useMemo)((function(){return(0,G.JU)(J.RZ,"chatroom",e)}),[e]);return(0,g.useEffect)((function(){return(0,G.cf)(i,(function(n){if(n.exists()){var e=n.data();if(r.current){if(!e.timestamp)return;var i=e.timestamp,o=i.seconds,a=i.nanoseconds;t((0,C.Z)((0,C.Z)({},e),{},{timestampMillis:new G.EK(o,a).toMillis()}))}else r.current=!0}else r.current=!0}))}),[e]),function(){var n=(0,c.Z)((0,a.Z)().mark((function n(e){var t;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.consultedId){n.next=4;break}return t=(0,G.JU)(J.RZ,"inbox",e.consultedId),n.next=4,(0,G.pl)(t,{content:e.content,timestamp:(0,G.Bt)()});case 4:return n.abrupt("return",(0,G.pl)(i,{content:e.content,userId:e.userId,timestamp:(0,G.Bt)(),contentType:e.contentType}));case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},X=t(2103),z=t(8655),Q=t(4453),nn=t(184),en=function(n){return n.format("YYYY-MM-DD")},tn=function(){var n,e,t,r,i,o,s,m=(0,y.UO)().id,x=(0,_.aC)(),j=(0,g.useRef)(null),R=(0,g.useState)(""),H=(0,u.Z)(R,2),V=H[0],$=H[1],q=(0,g.useState)([]),W=(0,u.Z)(q,2),G=W[0],tn=W[1],rn=(0,g.useRef)(),on=(0,g.useRef)(null),an=(0,g.useRef)(null),cn=function(n){var e=(0,C.Z)((0,C.Z)({},b),n);return Z.a(I,e)}({variables:{input:m||""},fetchPolicy:"no-cache"}),ln=function(n){var e=(0,C.Z)((0,C.Z)({},b),n);return w.D(k,e)}(),un=(0,u.Z)(ln,1)[0],sn=function(n){var e=(0,C.Z)((0,C.Z)({},b),n);return w.D(N,e)}(),dn=(0,u.Z)(sn,1)[0];rn.current=G;var vn=K({chatroomId:m||"",onMessage:function(n){var e=rn.current||[],t=[].concat((0,l.Z)(e),[{content:n.content||"",key:n.timestampMillis+"",userId:n.userId||"",contentType:n.contentType||""}]);tn(t),dn({variables:{input:{topicId:m||""}}}),fn()}});(0,g.useEffect)((function(){dn({variables:{input:{topicId:m||""}}})}),[]);var fn=function(){setTimeout((function(){var n;null===(n=on.current)||void 0===n||n.scrollIntoView({behavior:"smooth"})}),100)};if((0,g.useEffect)((function(){fn()}),[cn.loading]),cn.loading)return(0,nn.jsx)(X.Z.Loading,{});if(cn.error)return(0,nn.jsx)(X.Z.Error,{});var pn=function(n,e){n&&un({variables:{input:{topicId:m||"",content:n,contentType:"text"}},onCompleted:function(){return(0,c.Z)((0,a.Z)().mark((function t(){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,vn({content:n,userId:x.user.id,contentType:"text",consultedId:e});case 2:$(""),null===(r=j.current)||void 0===r||r.focus();case 4:case"end":return t.stop()}}),t)})))()}})},mn=null===(n=cn.data)||void 0===n||null===(e=n.topic)||void 0===e?void 0:e.clinic,hn=null===(t=cn.data)||void 0===t||null===(r=t.topic)||void 0===r?void 0:r.consult,_n=((null===(i=cn.data)||void 0===i||null===(o=i.topic)||void 0===o?void 0:o.replies)||[]).map((function(n){return{content:(null===n||void 0===n?void 0:n.content)||"",key:(null===n||void 0===n?void 0:n.id)||"",userId:(null===n||void 0===n?void 0:n.userId)||"",contentType:(null===n||void 0===n?void 0:n.contentType)||""}})),gn=h()(1e3*((null===hn||void 0===hn?void 0:hn.consultAt)||0)),yn=gn.add((null===hn||void 0===hn?void 0:hn.days)||0,"day"),Cn=h()(),xn=yn.diff(Cn,"day"),jn=null===hn||void 0===hn?void 0:hn.oneOnOne,Zn=((null===hn||void 0===hn?void 0:hn.images)||[]).map((function(n){return n||""})),wn=((null===hn||void 0===hn?void 0:hn.categories)||[]).map((function(n){return(null===n||void 0===n?void 0:n.name)||""})),bn=!!x.user.clinic;_n.push.apply(_n,(0,l.Z)(G));var In,kn,Nn=null===(s=_n.find((function(n){return n.userId!=x.user.id})))||void 0===s?void 0:s.userId;jn&&!Nn&&(Nn=(null===mn||void 0===mn||null===(In=mn.owners)||void 0===In||null===(kn=In[0])||void 0===kn?void 0:kn.id)||void 0);return(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)(p.Z,{leftArrow:!0,title:(null===mn||void 0===mn?void 0:mn.name)||""}),(0,nn.jsxs)(f.Z,{className:O,children:[bn?null:!(null!==mn&&void 0!==mn&&mn.paid)&&(0,nn.jsx)("div",{className:d()(T,S),children:"(\u8a3a\u6240\u975e\u4ed8\u8cbb\u6703\u54e1\uff0c\u53ef\u80fd\u7121\u6cd5\u56de\u8986\u8a0a\u606f)"}),!jn&&(0,nn.jsx)("div",{className:d()(T,S),children:(0,nn.jsx)(v.Z,{id:(null===hn||void 0===hn?void 0:hn.id)||"",title:(null===hn||void 0===hn?void 0:hn.subject)||"",date:"\u8d77\u59cb\u65e5 ".concat(en(gn),"\uff5c\u5230\u671f\u65e5 ").concat(en(yn)).concat(xn>0?"(\u5269\u9918".concat(xn,"\u5929)"):"(\u5df2\u904e\u671f)"),images:Zn,introduction:(null===hn||void 0===hn?void 0:hn.content)||"",tags:wn})}),_n.map((function(n){return(null===n||void 0===n?void 0:n.userId)==x.user.id?(0,nn.jsxs)("div",{className:d()(T,M),children:["text"===(null===n||void 0===n?void 0:n.contentType)&&(0,nn.jsx)("div",{className:D,children:null===n||void 0===n?void 0:n.content}),"image"===(null===n||void 0===n?void 0:n.contentType)&&(0,nn.jsx)("img",{className:Y,src:null===n||void 0===n?void 0:n.content})]},null===n||void 0===n?void 0:n.key):(0,nn.jsxs)("div",{className:d()(T,A),children:[x.user.clinic?(0,nn.jsx)("div",{className:B,children:"U"}):(0,nn.jsx)("img",{className:E,src:"/img/chatroom-user.png"}),"text"===(null===n||void 0===n?void 0:n.contentType)&&(0,nn.jsx)("div",{className:D,children:null===n||void 0===n?void 0:n.content}),"image"===(null===n||void 0===n?void 0:n.contentType)&&(0,nn.jsx)("img",{className:Y,src:null===n||void 0===n?void 0:n.content})]},null===n||void 0===n?void 0:n.key)})),(0,nn.jsx)("div",{ref:on})]}),xn>0&&(0,nn.jsx)("div",{className:L,children:(0,nn.jsxs)("div",{className:U,children:[(0,nn.jsx)(F,{onClick:function(){var n;null===(n=an.current)||void 0===n||n.click()}}),(0,nn.jsx)("input",{type:"file",accept:"image/*",style:{display:"none"},ref:an,onChange:function(n){var e,t,r=null===(e=n.target)||void 0===e||null===(t=e.files)||void 0===t?void 0:t[0];if(r){var i=(0,Q.iH)(J.tO,"image/".concat((0,z.Z)(),"/").concat((null===r||void 0===r?void 0:r.name)||""));(0,Q.KV)(i,r).then((function(n){return(0,Q.Jt)(n.ref)})).then((function(n){un({variables:{input:{topicId:m||"",content:n,contentType:"image"}},onCompleted:function(){return(0,c.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn({content:n,userId:x.user.id,contentType:"image",consultedId:Nn});case 2:an.current&&(an.current.value=""),null===(t=j.current)||void 0===t||t.focus();case 4:case"end":return e.stop()}}),e)})))()}})}))}}}),bn?(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("input",{ref:j,value:V,disabled:!(null!==mn&&void 0!==mn&&mn.paid),placeholder:null!==mn&&void 0!==mn&&mn.paid?"":"\u4ed8\u8cbb\u6703\u54e1\u5373\u53ef\u56de\u8986\u8a0a\u606f",onChange:function(n){return $(n.target.value)}}),null!==mn&&void 0!==mn&&mn.paid?(0,nn.jsx)("div",{className:P,onClick:function(){return pn(V,Nn)},children:"\u9001\u51fa"}):null]}):(0,nn.jsxs)(nn.Fragment,{children:[(0,nn.jsx)("input",{ref:j,value:V,onChange:function(n){return $(n.target.value)}}),(0,nn.jsx)("div",{className:P,onClick:function(){return pn(V,Nn)},children:"\u9001\u51fa"})]})]})})]})}},8655:function(n,e,t){var r=t(5984);e.Z=r.x0},5984:function(n,e,t){t.d(e,{x0:function(){return r}});var r=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;return crypto.getRandomValues(new Uint8Array(n)).reduce((function(n,e){return n+=(e&=63)<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_"}),"")}}}]);
//# sourceMappingURL=760.61852737.chunk.js.map